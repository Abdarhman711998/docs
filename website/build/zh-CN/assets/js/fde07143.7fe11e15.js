"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2686],{69289:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var o=t(85893),a=t(11151);const i={id:"lido",title:"Lido Example"},s="Hello Lido!",r={id:"bos/tutorial/lido",title:"Lido Example",description:"If you are ready to explore further, the Lido component serves as an excellent fully-fledged example, as it demonstrates how to interact with a smart contract deployed on the Ethereum mainnet.",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/bos/tutorial/hello-lido.md",sourceDirName:"bos/tutorial",slug:"/bos/tutorial/lido",permalink:"/zh-CN/bos/tutorial/lido",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/bos/tutorial/hello-lido.md",tags:[],version:"current",lastUpdatedBy:"Github Actions",lastUpdatedAt:1704996595,formattedLastUpdatedAt:"2024\u5e741\u670811\u65e5",frontMatter:{id:"lido",title:"Lido Example"},sidebar:"tutorials",previous:{title:"Best Practices for Ethereum developers on NEAR",permalink:"/zh-CN/bos/tutorial/ethers-js-best-practices"},next:{title:"Introduction",permalink:"/zh-CN/tutorials/fts/introduction"}},d={},l=[{value:"Fork the component",id:"fork-the-component",level:3},{value:"Source code",id:"source-code",level:3},{value:"Fork the component",id:"fork-the-component-1",level:4}];function c(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"hello-lido",children:"Hello Lido!"}),"\n",(0,o.jsx)(e.p,{children:"If you are ready to explore further, the Lido component serves as an excellent fully-fledged example, as it demonstrates how to interact with a smart contract deployed on the Ethereum mainnet."}),"\n",(0,o.jsx)(e.h3,{id:"fork-the-component",children:"Fork the component"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["Navigate to ",(0,o.jsx)(e.a,{href:"https://bos.gg/#/zavodil.near/widget/Lido",children:"the component"})]}),"\n",(0,o.jsx)(e.li,{children:"Click on the menu icon in the top-right corner"}),"\n",(0,o.jsxs)(e.li,{children:["Select ",(0,o.jsx)(e.code,{children:"Fork"})]}),"\n",(0,o.jsx)(e.li,{children:"Feel free to make any changes"}),"\n",(0,o.jsx)(e.li,{children:'Click on "Save" to deploy the component'}),"\n"]}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsx)(e.p,{children:"To deploy the component, you'll need to sign in with a NEAR account and to make a deposit of a small amount of NEAR for the storage cost. This is because the components are stored in the NEAR network."})}),"\n",(0,o.jsx)(e.h3,{id:"source-code",children:"Source code"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'// FETCH LIDO ABI\n\nconst lidoContract = "0xae7ab96520de3a18e5e111b5eaab095312d7fe84";\nconst tokenDecimals = 18;\n\nconst lidoAbi = fetch(\n  "https://raw.githubusercontent.com/lidofinance/lido-subgraph/master/abis/Lido.json"\n);\nif (!lidoAbi.ok) {\n  return "Loading";\n}\n\nconst iface = new ethers.utils.Interface(lidoAbi.body);\n\n// FETCH LIDO STAKING APR\n\nif (state.lidoArp === undefined) {\n  const apr = fetch(\n    "https://api.allorigins.win/get?url=https://stake.lido.fi/api/sma-steth-apr"\n  );\n  if (!apr) return;\n  State.update({ lidoArp: JSON.parse(apr?.body?.contents) ?? "..." });\n}\n\n// HELPER FUNCTIONS\n\nconst getStakedBalance = (receiver) => {\n  const encodedData = iface.encodeFunctionData("balanceOf", [receiver]);\n\n  return Ethers.provider()\n    .call({\n      to: lidoContract,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = iface.decodeFunctionResult(\n        "balanceOf",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(tokenDecimals))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, "$&,");\n    });\n};\n\nconst submitEthers = (strEther, _referral) => {\n  if (!strEther) {\n    return console.log("Amount is missing");\n  }\n  const erc20 = new ethers.Contract(\n    lidoContract,\n    lidoAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  let amount = ethers.utils.parseUnits(strEther, tokenDecimals).toHexString();\n\n  erc20.submit(lidoContract, { value: amount }).then((transactionHash) => {\n    console.log("transactionHash is " + transactionHash);\n  });\n};\n\n// DETECT SENDER\n\nif (state.sender === undefined) {\n  State.update({ sender: Ethers.send("eth_requestAccounts", [])[0] });\n}\n\nif (!state.sender) return "Please login first";\n\n// FETCH SENDER BALANCE\n\nif (state.balance === undefined) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\n// FETCH SENDER STETH BALANCE\n\nif (state.stakedBalance === undefined) {\n  getStakedBalance(state.sender).then((stakedBalance) => {\n    State.update({ stakedBalance });\n  });\n}\n\n// FETCH TX COST\n\nif (state.txCost === undefined) {\n  const gasEstimate = ethers.BigNumber.from(1875000);\n  const gasPrice = ethers.BigNumber.from(1500000000);\n\n  const gasCostInWei = gasEstimate.mul(gasPrice);\n  const gasCostInEth = ethers.utils.formatEther(gasCostInWei);\n\n  let responseGql = fetch(\n    "https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2",\n    {\n      method: "POST",\n      headers: { "Content-Type": "application/json" },\n      body: JSON.stringify({\n        query: `{\n          bundle(id: "1" ) {\n            ethPrice\n          }\n        }`,\n      }),\n    }\n  );\n\n  if (!responseGql) return "";\n\n  const ethPriceInUsd = responseGql.body.data.bundle.ethPrice;\n\n  const txCost = Number(gasCostInEth) * Number(ethPriceInUsd);\n\n  State.update({ txCost: `$${txCost.toFixed(2)}` });\n}\n\n// FETCH CSS\n\nconst cssFont = fetch(\n  "https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800"\n).body;\nconst css = fetch(\n  "https://pluminite.mypinata.cloud/ipfs/Qmboz8aoSvVXLeP5pZbRtNKtDD3kX5D9DEnfMn2ZGSJWtP"\n).body;\n\nif (!cssFont || !css) return "";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n      font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,\n        Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n      ${cssFont}\n      ${css}\n    `,\n  });\n}\nconst Theme = state.theme;\n\n// OUTPUT UI\n\nreturn (\n  <Theme>\n    <div class="LidoContainer">\n      <div class="Header">Stake Ether</div>\n      <div class="SubHeader">Stake ETH and receive stETH while staking.</div>\n\n      <div class="LidoForm">\n        <div class="LidoFormTopContainer">\n          <div class="LidoFormTopContainerLeft">\n            <div class="LidoFormTopContainerLeftContent1">\n              <div class="LidoFormTopContainerLeftContent1Container">\n                <span>Available to stake</span>\n                <div class="LidoFormTopContainerLeftContent1Circle" />\n              </div>\n            </div>\n            <div class="LidoFormTopContainerLeftContent2">\n              <span>{state.balance ?? "..."}&nbsp;ETH</span>\n            </div>\n          </div>\n          <div class="LidoFormTopContainerRight">\n            <div class="LidoFormTopContainerRightContent1">\n              <div class="LidoFormTopContainerRightContent1Text">\n                <span>\n                  {state.sender.substring(0, 6)}...\n                  {state.sender.substring(\n                    state.sender.length - 4,\n                    state.sender.length\n                  )}{" "}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="LidoSplitter" />\n        <div class="LidoFormBottomContainer">\n          <div class="LidoFormTopContainerLeft">\n            <div class="LidoFormTopContainerLeftContent1">\n              <div class="LidoFormTopContainerLeftContent1Container">\n                <span>Staked amount</span>\n              </div>\n            </div>\n            <div class="LidoFormTopContainerLeftContent2">\n              <span>{state.stakedBalance ?? "..."}&nbsp;stETH</span>\n            </div>\n          </div>\n          <div class="LidoFormTopContainerRight">\n            <div class="LidoAprContainer">\n              <div class="LidoAprTitle">Lido APR</div>\n              <div class="LidoAprValue">{state.lidoArp ?? "..."}%</div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="LidoStakeForm">\n        <div class="LidoStakeFormInputContainer">\n          <span class="LidoStakeFormInputContainerSpan1">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n              <path\n                opacity="0.6"\n                d="M11.999 3.75v6.098l5.248 2.303-5.248-8.401z"\n              ></path>\n              <path d="M11.999 3.75L6.75 12.151l5.249-2.303V3.75z"></path>\n              <path\n                opacity="0.6"\n                d="M11.999 16.103v4.143l5.251-7.135L12 16.103z"\n              ></path>\n              <path d="M11.999 20.246v-4.144L6.75 13.111l5.249 7.135z"></path>\n              <path\n                opacity="0.2"\n                d="M11.999 15.144l5.248-2.993-5.248-2.301v5.294z"\n              ></path>\n              <path\n                opacity="0.6"\n                d="M6.75 12.151l5.249 2.993V9.85l-5.249 2.3z"\n              ></path>\n            </svg>\n          </span>\n          <span class="LidoStakeFormInputContainerSpan2">\n            <input\n              class="LidoStakeFormInputContainerSpan2Input"\n              value={state.strEther}\n              onChange={(e) => State.update({ strEther: e.target.value })}\n              placeholder="Amount"\n            />\n          </span>\n          <span\n            class="LidoStakeFormInputContainerSpan3"\n            onClick={() => {\n              State.update({\n                strEther: (parseFloat(state.balance) - 0.05).toFixed(2),\n              });\n            }}\n          >\n            <button class="LidoStakeFormInputContainerSpan3Content">\n              <span class="LidoStakeFormInputContainerSpan3Max">MAX</span>\n            </button>\n          </span>\n        </div>\n        <button\n          class="LidoStakeFormSubmitContainer"\n          onClick={() => submitEthers(state.strEther, state.sender)}\n        >\n          <span>Submit</span>\n        </button>\n\n        <div class="LidoFooterContainer">\n          <div class="LidoFooterRaw">\n            <div class="LidoFooterRawLeft">You will receive</div>\n            <div class="LidoFooterRawRight">${state.strEther ?? 0} stETH</div>\n          </div>\n          <div class="LidoFooterRaw">\n            <div class="LidoFooterRawLeft">Exchange rate</div>\n            <div class="LidoFooterRawRight">1 ETH = 1 stETH</div>\n          </div>\n          <div class="LidoFooterRaw">\n            <div class="LidoFooterRawLeft">Transaction cost</div>\n            <div class="LidoFooterRawRight">{state.txCost}</div>\n          </div>\n          <div class="LidoFooterRaw">\n            <div class="LidoFooterRawLeft">Reward fee</div>\n            <div class="LidoFooterRawRight">10%</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Theme>\n);\n'})}),"\n",(0,o.jsx)(e.h4,{id:"fork-the-component-1",children:"Fork the component"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["Navigate to ",(0,o.jsx)(e.a,{href:"https://bos.gg/#/zavodil.near/widget/Lido",children:"the component"})]}),"\n",(0,o.jsx)(e.li,{children:"Click on the menu icon in the top-right corner"}),"\n",(0,o.jsxs)(e.li,{children:["Select ",(0,o.jsx)(e.code,{children:"Fork"})]}),"\n",(0,o.jsx)(e.li,{children:"Feel free to make any changes"}),"\n",(0,o.jsx)(e.li,{children:'Click on "Save" to deploy the component'}),"\n"]}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsx)(e.p,{children:"To deploy the component, you'll need to sign in with a NEAR account and to make a deposit of a small amount of NEAR for the storage cost. This is because NEAR components are stored in the NEAR network."})})]})}function p(n={}){const{wrapper:e}={...(0,a.a)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}},11151:(n,e,t)=>{t.d(e,{Z:()=>r,a:()=>s});var o=t(67294);const a={},i=o.createContext(a);function s(n){const e=o.useContext(i);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),o.createElement(i.Provider,{value:e},n.children)}}}]);