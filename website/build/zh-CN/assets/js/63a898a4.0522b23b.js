"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6893],{42505:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=n(85893),a=n(11151);n(74866),n(85162);const i={id:"indexer-for-explorer",title:"Indexer for Explorer (Deprecated)"},s=void 0,o={id:"tools/indexer-for-explorer",title:"Indexer for Explorer (Deprecated)",description:"While developing a decentralized app you might want to query usage information for a contract such as:",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/4.tools/indexer4explorer.md",sourceDirName:"4.tools",slug:"/tools/indexer-for-explorer",permalink:"/zh-CN/tools/indexer-for-explorer",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/4.tools/indexer4explorer.md",tags:[],version:"current",lastUpdatedBy:"Github Actions",lastUpdatedAt:1712954223e3,frontMatter:{id:"indexer-for-explorer",title:"Indexer for Explorer (Deprecated)"}},l={},c=[{value:"Example Queries",id:"example-queries",level:2},{value:"Transactions Calling a Method",id:"transactions-calling-a-method",level:3},{value:"Users, Status, and Attached Money",id:"users-status-and-attached-money",level:3},{value:"Sent Money",id:"sent-money",level:3},{value:"NEAR Explorer sunsetting",id:"near-explorer-sunsetting",level:2},{value:"What exactly is being shut down?",id:"what-exactly-is-being-shut-down",level:3},{value:"What is the timeline?",id:"what-is-the-timeline",level:3},{value:"What does this mean for me?",id:"what-does-this-mean-for-me",level:3},{value:"What are the alternatives?",id:"what-are-the-alternatives",level:3},{value:"Analytics Use-Case",id:"analytics-use-case",level:4},{value:"Web or API usage",id:"web-or-api-usage",level:4},{value:"Can I still continue using Explorer Database?",id:"can-i-still-continue-using-explorer-database",level:3}];function u(e){const r={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"While developing a decentralized app you might want to query usage information for a contract such as:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Which users have called a specific method in my contract?"}),"\n",(0,t.jsx)(r.li,{children:"How much money and gas did they deposit?"}),"\n",(0,t.jsx)(r.li,{children:"Which transactions failed?"}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["In order to simplify asking these questions is that we developed the ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-indexer-for-explorer",children:"NEAR Indexer for Explorer"}),"."]}),"\n",(0,t.jsxs)(r.p,{children:["Both ",(0,t.jsx)(r.code,{children:"testnet"})," and ",(0,t.jsx)(r.code,{children:"mainnet"})," networks have active instances that fill the database with all the data from the network starting from the genesis as ",(0,t.jsx)(r.a,{href:"https://nearblocks.io/",children:"Explorer"})," requires."]}),"\n",(0,t.jsx)(r.admonition,{title:"GitHub repo",type:"info",children:(0,t.jsxs)(r.p,{children:["NEAR Indexer for Explorer is an indexer built on top of ",(0,t.jsx)(r.a,{href:"/concepts/advanced/near-indexer-framework",children:"NEAR Indexer microframework"}),". It watches the network and stores all the data from the blockchain in the PostgreSQL database. You can find the source code on ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-indexer-for-explorer",children:"this GitHub repository"}),"."]})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"example-queries",children:"Example Queries"}),"\n",(0,t.jsx)(r.h3,{id:"transactions-calling-a-method",children:"Transactions Calling a Method"}),"\n",(0,t.jsxs)(r.p,{children:["Query for all transactions that called ",(0,t.jsx)(r.code,{children:"contribute"})," in the ",(0,t.jsx)(r.code,{children:"v1.faucet.nonofficial.testnet"})," testnet account."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sql",children:"select r.predecessor_account_id, t.transaction_hash \nfrom receipts r, action_receipt_actions ara, transactions t\nwhere r.receiver_account_id ='v1.faucet.nonofficial.testnet'\n  and ara.receipt_id = r.receipt_id\n  and ara.action_kind = 'FUNCTION_CALL'\n  and ara.args @> '{\"method_name\": \"contribute\"}'\n  and t.transaction_hash = r.originated_from_transaction_hash\n"})}),"\n",(0,t.jsx)("hr",{className:"subsection"}),"\n",(0,t.jsx)(r.h3,{id:"users-status-and-attached-money",children:"Users, Status, and Attached Money"}),"\n",(0,t.jsxs)(r.p,{children:["Query for all users that called ",(0,t.jsx)(r.code,{children:"contribute"})," in ",(0,t.jsx)(r.code,{children:"v1.faucet.nonofficial.testnet"}),", how much they attached to the call, and the transaction status."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sql",children:"select t.transaction_hash, eo.status, r.predecessor_account_id , ara.args -> 'deposit' as deposit\nfrom receipts r, action_receipt_actions ara, transactions t, execution_outcomes eo\nwhere r.receiver_account_id ='v1.faucet.nonofficial.testnet'\n  and ara.receipt_id = r.receipt_id and ara.action_kind = 'FUNCTION_CALL'\n  and ara.args @> '{\"method_name\": \"contribute\"}'\n  and t.transaction_hash = r.originated_from_transaction_hash\n  and r.receipt_id = eo.receipt_id\n"})}),"\n",(0,t.jsx)("hr",{className:"subsection"}),"\n",(0,t.jsx)(r.h3,{id:"sent-money",children:"Sent Money"}),"\n",(0,t.jsxs)(r.p,{children:["Query for all the transfers going out from ",(0,t.jsx)(r.code,{children:"v1.faucet.nonofficial.testnet"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sql",children:"select r.receiver_account_id, ara.args -> 'deposit' as deposit  \nfrom receipts r, action_receipt_actions ara\nwhere r.predecessor_account_id  ='v1.faucet.nonofficial.testnet'\n  and ara.receipt_id = r.receipt_id and ara.action_kind = 'TRANSFER'\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"near-explorer-sunsetting",children:"NEAR Explorer sunsetting"}),"\n",(0,t.jsxs)(r.p,{children:["Pagoda made a decision to sunset NEAR Explorer as a product. This means that ",(0,t.jsx)(r.code,{children:"nearblocks.io"})," (and ",(0,t.jsx)(r.code,{children:"explorer.testnet.near.org"}),") will become a landing page with a list of available alternatives, and the existing ",(0,t.jsx)(r.a,{href:"https://nearblocks.io",children:"nearblocks.io"})," will be hosted under a new domain name and will be transitioned to the community through DevHub. ",(0,t.jsx)(r.a,{href:"https://near.social/devgovgigs.near/widget/gigs-board.pages.Post?id=635",children:"Read more here"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"what-exactly-is-being-shut-down",children:"What exactly is being shut down?"}),"\n",(0,t.jsx)(r.p,{children:"You will lose access to databases with these URLs, or other Replicas you might have been given access to:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"testnet.db.explorer.indexer.near.dev/testnet_explorer"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"mainnet.db.explorer.indexer.near.dev/mainnet_explorer"})}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["There is no plan to shut down any other data products, such as ",(0,t.jsx)(r.a,{href:"https://docs.near.org/concepts/advanced/near-lake-framework",children:"NEAR Lake"})," or ",(0,t.jsx)(r.a,{href:"https://www.pagoda.co/enhanced-api",children:"EnhancedAPI"})," at the moment."]}),"\n",(0,t.jsx)(r.h3,{id:"what-is-the-timeline",children:"What is the timeline?"}),"\n",(0,t.jsx)(r.p,{children:"Postgres users will lose access to data on the 30th of November, Thursday (12:00 pm Pacific Time Zone). Please migrate to one of the options listed below instead. Please migrate to one of the options listed below instead."}),"\n",(0,t.jsx)(r.h3,{id:"what-does-this-mean-for-me",children:"What does this mean for me?"}),"\n",(0,t.jsxs)(r.p,{children:["If you are using the public Postgres Explorer Database, you will need to migrate to other solutions, depending on your use-case. You should start planning for it right now and reach out to ",(0,t.jsx)(r.a,{href:"https://nearbuilders.com/tg-data",children:"this Telegram group"})," to get help. You should start planning for it right now and reach out to ",(0,t.jsx)(r.a,{href:"https://nearbuilders.com/tg-data",children:"this Telegram group"})," to get help."]}),"\n",(0,t.jsx)(r.h3,{id:"what-are-the-alternatives",children:"What are the alternatives?"}),"\n",(0,t.jsx)(r.p,{children:"There are two major use-cases that you might be using Explorer DB for: analytics and real-time queries from web user interfaces."}),"\n",(0,t.jsx)(r.h4,{id:"analytics-use-case",children:"Analytics Use-Case"}),"\n",(0,t.jsx)(r.p,{children:"This is if you use Explorer DB to build internal or external dashboards. This is if you use Explorer DB to build internal or external dashboards. Pagoda has been working with Google Web3 team to enable BigQuery public dataset that has a compatible schema with Explorer DB."}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["Find more information about our ",(0,t.jsx)(r.a,{href:"/zh-CN/build/data-infrastructure/big-query",children:"BigQuery solution here"}),"."]})}),"\n",(0,t.jsx)(r.h4,{id:"web-or-api-usage",children:"Web or API usage"}),"\n",(0,t.jsx)(r.p,{children:"This is if you make queries to Explorer DB in response to API requests that your users make on your application. There are various options that you can explore: There are various options that you can explore:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["If you are working with token balances, including $NEAR, fungible or non-fungible tokens, consider using ",(0,t.jsx)(r.a,{href:"https://www.pagoda.co/enhanced-api",children:"Enhanced API"})," hosted by Pagoda, or run it yourself using ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-enhanced-api-server",children:"https://github.com/near/near-enhanced-api-server"})," and ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-microindexers",children:"https://github.com/near/near-microindexers"})]}),"\n",(0,t.jsxs)(r.li,{children:["Use NEAR QueryAPI \u2013 serverless indexers and GraphQL endpoints: ",(0,t.jsx)(r.a,{href:"https://dev.near.org/s/p?a=nearpavel.near&b=97029570",children:"https://dev.near.org/s/p?a=nearpavel.near&b=97029570"})]}),"\n",(0,t.jsxs)(r.li,{children:["Use NEAR Lake Indexer. Use NEAR Lake Indexer. Create an indexer using ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-lake-framework-rs",children:"Rust"}),", ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-lake-framework-js",children:"JavaScript"}),". There are other languages supported by community, ",(0,t.jsx)(r.a,{href:"https://github.com/search?q=near-lake-framework&type=repositories",children:"try this search"}),". There are other languages supported by community, ",(0,t.jsx)(r.a,{href:"https://github.com/search?q=near-lake-framework&type=repositories",children:"try this search"}),"."]}),"\n",(0,t.jsx)(r.li,{children:"Consider other indexer solutions built by the community"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"can-i-still-continue-using-explorer-database",children:"Can I still continue using Explorer Database?"}),"\n",(0,t.jsxs)(r.p,{children:["No, you won\u2019t be able to continue using Public Explorer Database after the sunset. However you can start your own instance of ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-indexer-for-explorer",children:"https://github.com/near/near-indexer-for-explorer"})," and reindex the history from scratch or use a latest backup. We will share a backup of Explorer DB in September if you want to run your own instance. However you can start your own instance of ",(0,t.jsx)(r.a,{href:"https://github.com/near/near-indexer-for-explorer",children:"https://github.com/near/near-indexer-for-explorer"})," and reindex the history from scratch or use a latest backup. We will share a backup of Explorer DB in September if you want to run your own instance."]}),"\n",(0,t.jsx)(r.p,{children:"To run your own infra, you will need:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Indexer services:"})," We use two e2-medium instances on GCP for redundancy, with 2 vCPUs and 4GB of RAM."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"A database:"})," We use Postgres version 11, with 8+ vCPUs, 52GB+ RAM and ~8TB of SSD storage. In addition, we recommend running an extra read-replica on a similar or more powerful machine. In addition, we recommend running an extra read-replica on a similar or more powerful machine."]}),"\n"]})]})}function d(e={}){const{wrapper:r}={...(0,a.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},85162:(e,r,n)=>{n.d(r,{Z:()=>s});n(67294);var t=n(36905);const a={tabItem:"tabItem_Ymn6"};var i=n(85893);function s(e){var r=e.children,n=e.hidden,s=e.className;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.Z)(a.tabItem,s),hidden:n,children:r})}},74866:(e,r,n)=>{n.d(r,{Z:()=>y});var t=n(67294),a=n(36905),i=n(12466),s=n(16550),o=n(20469),l=n(91980),c=n(67392),u=n(50012);function d(e){var r,n;return null!=(r=null==(n=t.Children.toArray(e).filter((function(e){return"\n"!==e})).map((function(e){if(!e||(0,t.isValidElement)(e)&&((r=e.props)&&"object"==typeof r&&"value"in r))return e;var r;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?r:[]}function h(e){var r=e.values,n=e.children;return(0,t.useMemo)((function(){var e=null!=r?r:function(e){return d(e).map((function(e){var r=e.props;return{value:r.value,label:r.label,attributes:r.attributes,default:r.default}}))}(n);return function(e){var r=(0,c.l)(e,(function(e,r){return e.value===r.value}));if(r.length>0)throw new Error('Docusaurus error: Duplicate values "'+r.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[r,n])}function p(e){var r=e.value;return e.tabValues.some((function(e){return e.value===r}))}function f(e){var r=e.queryString,n=void 0!==r&&r,a=e.groupId,i=(0,s.k6)(),o=function(e){var r=e.queryString,n=void 0!==r&&r,t=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:a});return[(0,l._X)(o),(0,t.useCallback)((function(e){if(o){var r=new URLSearchParams(i.location.search);r.set(o,e),i.replace(Object.assign({},i.location,{search:r.toString()}))}}),[o,i])]}function x(e){var r,n,a,i,s=e.defaultValue,l=e.queryString,c=void 0!==l&&l,d=e.groupId,x=h(e),m=(0,t.useState)((function(){return function(e){var r,n=e.defaultValue,t=e.tabValues;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+t.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var a=null!=(r=t.find((function(e){return e.default})))?r:t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:s,tabValues:x})})),g=m[0],b=m[1],v=f({queryString:c,groupId:d}),j=v[0],w=v[1],y=(r=function(e){return e?"docusaurus.tab."+e:null}({groupId:d}.groupId),n=(0,u.Nk)(r),a=n[0],i=n[1],[a,(0,t.useCallback)((function(e){r&&i.set(e)}),[r,i])]),k=y[0],_=y[1],E=function(){var e=null!=j?j:k;return p({value:e,tabValues:x})?e:null}();return(0,o.Z)((function(){E&&b(E)}),[E]),{selectedValue:g,selectValue:(0,t.useCallback)((function(e){if(!p({value:e,tabValues:x}))throw new Error("Can't select invalid tab value="+e);b(e),w(e),_(e)}),[w,_,x]),tabValues:x}}var m=n(72389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(85893);function v(e){var r=e.className,n=e.block,t=e.selectedValue,s=e.selectValue,o=e.tabValues,l=[],c=(0,i.o5)().blockElementScrollPositionUntilNextRender,u=function(e){var r=e.currentTarget,n=l.indexOf(r),a=o[n].value;a!==t&&(c(r),s(a))},d=function(e){var r,n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":var t,a=l.indexOf(e.currentTarget)+1;n=null!=(t=l[a])?t:l[0];break;case"ArrowLeft":var i,s=l.indexOf(e.currentTarget)-1;n=null!=(i=l[s])?i:l[l.length-1]}null==(r=n)||r.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},r),children:o.map((function(e){var r=e.value,n=e.label,i=e.attributes;return(0,b.jsx)("li",Object.assign({role:"tab",tabIndex:t===r?0:-1,"aria-selected":t===r,ref:function(e){return l.push(e)},onKeyDown:d,onClick:u},i,{className:(0,a.Z)("tabs__item",g.tabItem,null==i?void 0:i.className,{"tabs__item--active":t===r}),children:null!=n?n:r}),r)}))})}function j(e){var r=e.lazy,n=e.children,a=e.selectedValue,i=(Array.isArray(n)?n:[n]).filter(Boolean);if(r){var s=i.find((function(e){return e.props.value===a}));return s?(0,t.cloneElement)(s,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map((function(e,r){return(0,t.cloneElement)(e,{key:r,hidden:e.props.value!==a})}))})}function w(e){var r=x(e);return(0,b.jsxs)("div",{className:(0,a.Z)("tabs-container",g.tabList),children:[(0,b.jsx)(v,Object.assign({},r,e)),(0,b.jsx)(j,Object.assign({},r,e))]})}function y(e){var r=(0,m.Z)();return(0,b.jsx)(w,Object.assign({},e,{children:d(e.children)}),String(r))}},11151:(e,r,n)=>{n.d(r,{Z:()=>o,a:()=>s});var t=n(67294);const a={},i=t.createContext(a);function s(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);