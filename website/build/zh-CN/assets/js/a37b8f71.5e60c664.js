"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6310],{14059:(t,e,o)=>{o.r(e),o.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var s=o(85893),n=o(11151);const r={id:"storage",title:"Million Small Deposits"},a=void 0,i={id:"build/smart-contracts/security/storage",title:"Million Small Deposits",description:"On NEAR, your contract pays for the storage it uses. This means that the more data you store, the more balance you need to cover for storage. If you don't handle these costs correctly (e.g. asking the user to cover their storage usage), then a million little deposits can drain your contract of its funds.",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/2.build/2.smart-contracts/security/storage.md",sourceDirName:"2.build/2.smart-contracts/security",slug:"/build/smart-contracts/security/storage",permalink:"/zh-CN/build/smart-contracts/security/storage",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/2.build/2.smart-contracts/security/storage.md",tags:[],version:"current",frontMatter:{id:"storage",title:"Million Small Deposits"},sidebar:"build",previous:{title:"\u2705 Checklist",permalink:"/zh-CN/build/smart-contracts/security/checklist"},next:{title:"Cross-Contract Calls",permalink:"/zh-CN/build/smart-contracts/security/callbacks"}},c={},l=[];function d(t){const e={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",strong:"strong",...(0,n.a)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"On NEAR, your contract pays for the storage it uses. This means that the more data you store, the more balance you need to cover for storage. If you don't handle these costs correctly (e.g. asking the user to cover their storage usage), then a million little deposits can drain your contract of its funds."}),"\n",(0,s.jsx)(e.p,{children:"Let's walk through an example:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["You launch ",(0,s.jsx)(e.a,{href:"https://examples.near.org/guest-book-js",children:"a guest book app"}),", deploying your app's smart contract to the account ",(0,s.jsx)(e.code,{children:"example.near"})]}),"\n",(0,s.jsxs)(e.li,{children:["Visitors to your app can add messages to the guest book. This means your users will pay a small gas fee to ",(0,s.jsx)(e.strong,{children:"store"})," their message to your contract."]}),"\n",(0,s.jsxs)(e.li,{children:["When a new message comes in, NEAR will check if ",(0,s.jsx)(e.code,{children:"example.near"})," has enough balance to cover the new storage needs. If it does not, the transaction will fail."]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Note that this can create an attack surface. If sending data to your guest book is inexpensive to the user while costing the contract owner significantly more, a malicious user can exploit the imbalance to make maintaining the contract prohibitively expensive."}),"\n",(0,s.jsx)(e.p,{children:"One possible way to tackle this problem is asking the user to attach money to the call to cover the storage used by their message."}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.mdxAdmonitionTitle,{children:["Remember that you can release the ",(0,s.jsx)(e.em,{children:"balance locked for storage"})," by simply deleting data from the contract."]})})})]})}function u(t={}){const{wrapper:e}={...(0,n.a)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(d,{...t})}):d(t)}},11151:(t,e,o)=>{o.d(e,{Z:()=>i,a:()=>a});var s=o(67294);const n={},r=s.createContext(n);function a(t){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(n):t.components||n:a(t.components),s.createElement(r.Provider,{value:e},t.children)}}}]);